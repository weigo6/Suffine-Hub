---
title: åŸºäº EdgeOne Pages å®ç°ç«™ç‚¹è®¿é—®ç»Ÿè®¡åŠŸèƒ½
tags:
  - Web
  - Zensical
  - EdgeOne
  - Cloudflare
icon: material/web
comments: true
status: new
---

# ç”¨ EdgeOne Pages é›¶æˆæœ¬æ­å»ºåšå®¢è®¿é—®è®¡æ•°å™¨

åœ¨æ­å»ºä¸ªäººåšå®¢æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¸€ä¸ªç®€å•ã€ç²¾å‡†ä¸”ä¿æŠ¤éšç§çš„è®¿é—®é‡ç»Ÿè®¡å·¥å…·ã€‚Google Analytics åŠŸèƒ½å¼ºå¤§ä½†è¿‡äºè‡ƒè‚¿ä¸”æ¶‰åŠéšç§é—®é¢˜ï¼Œå¸‚é¢ä¸Šçš„å•†ä¸šç»Ÿè®¡æœåŠ¡åˆå¤§å¤šæ”¶è´¹ã€‚

ç¬”è€…ä¸ºäº†æ»¡è¶³è‡ªå·±åšå®¢å…¨ç«™è®¿é—®æ•°åŠæ–‡ç« é¡µè®¿é—®æ•°çš„ç»Ÿè®¡éœ€æ±‚ï¼Œå¼€å‘äº† **EO-Counter** ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ©ç”¨ **è…¾è®¯äº‘ EdgeOne Pages** çš„è¾¹ç¼˜å‡½æ•°ï¼ˆEdge Functionsï¼‰å’Œ KV å­˜å‚¨æ„å»ºçš„è½»é‡çº§è®¿é—®ç»Ÿè®¡æ–¹æ¡ˆã€‚å®ƒå®Œå…¨å…è´¹ï¼ˆåœ¨å…è´¹é¢åº¦å†…ï¼‰ã€æ— éœ€ç»´æŠ¤æœåŠ¡å™¨ã€è‡ªå¸¦å¯è§†åŒ–åå°ï¼Œå¹¶ä¸”æ”¯æŒæå…¶çµæ´»çš„å‰ç«¯é›†æˆã€‚

æœ¬æ–‡ä»¥ Zensical/Mkdocs-material è¿™ç±»ç°ä»£é™æ€æ–‡æ¡£ç«™ç‚¹ä¸ºä¾‹ï¼Œè®²è§£å¦‚ä½•éƒ¨ç½² EO-Counter é¡¹ç›®ã€‚

!!! tip
    å…¶ä»–ç«™ç‚¹çš„éƒ¨ç½²åŠæ›´è¯¦ç»†çš„åç«¯éƒ¨ç½²ç»†åˆ™å‚è€ƒ **EO-Counter** çš„ [Github READMEè¯´æ˜](https://github.com/weigo6/eo-counter) ã€‚

## ğŸŒŸ EO-Counter çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

- **ğŸ’¸ çœŸæ­£çš„é›¶æˆæœ¬**ï¼šåˆ©ç”¨ EdgeOne Pages çš„å…è´¹é¢åº¦ï¼Œä¸ªäººåšå®¢ç»°ç»°æœ‰ä½™ã€‚
- **âš¡ è¾¹ç¼˜ä½å»¶è¿Ÿ**ï¼šç»Ÿè®¡é€»è¾‘è¿è¡Œåœ¨è¾¹ç¼˜èŠ‚ç‚¹ï¼Œå…¨çƒè®¿é—®é€Ÿåº¦æå¿«ã€‚
- **ğŸ”’ æ•°æ®ç§æœ‰åŒ–**ï¼šæ•°æ®å­˜å‚¨åœ¨ä½ è‡ªå·±çš„è…¾è®¯äº‘è´¦å·ä¸‹ï¼Œå®‰å…¨å¯æ§ã€‚
- **ğŸ“Š å¯è§†åŒ–çœ‹æ¿**ï¼šè‡ªå¸¦ç®¡ç†åå°ï¼Œæ”¯æŒæŸ¥çœ‹çƒ­åŠ›å›¾ã€æœç´¢è·¯å¾„ã€ç”šè‡³æ‰‹åŠ¨ä¿®æ­£æ•°æ®ã€‚
- **ğŸ§© å®Œç¾é€‚é… SSG**ï¼šä¸“ä¸º Hexo, Hugo, MkDocs, Zensical ç­‰é™æ€åšå®¢è®¾è®¡ã€‚

## ğŸ› ï¸ ç¬¬ä¸€æ­¥ï¼šåç«¯éƒ¨ç½² (EdgeOne Pages)

åªéœ€äº”åˆ†é’Ÿå³å¯å®ŒæˆæœåŠ¡ç«¯çš„æ­å»ºã€‚

1.  **è·å–ä»£ç **ï¼š
    ç™»å½• GitHubï¼ŒFork æˆ–ä¸‹è½½ [EO-Counter ä»“åº“](https://github.com/weigo6/eo-counter)ã€‚

2.  **åˆ›å»ºé¡¹ç›®**ï¼š
    å‰å¾€ [è…¾è®¯äº‘ EdgeOne Pages æ§åˆ¶å°](https://console.cloud.tencent.com/edgeone/pages)ï¼Œç‚¹å‡»â€œæ–°å»ºé¡¹ç›®â€ï¼Œé€‰æ‹©ä½ åˆšæ‰ Fork çš„ GitHub ä»“åº“ã€‚æ„å»ºé…ç½®ä¿æŒé»˜è®¤å³å¯ã€‚

3.  **é…ç½®æ•°æ®åº“ (KV)**ï¼š
    - åœ¨ Pages æ§åˆ¶å°åˆ›å»º KV å‘½åç©ºé—´ã€‚
    - åœ¨é¡¹ç›®è®¾ç½®ä¸­ï¼Œç»‘å®š KV å‘½åç©ºé—´ï¼Œ**å˜é‡åå¿…é¡»å¡«å†™ä¸º `BLOG_DB`**ã€‚

4.  **è®¾ç½®ç¯å¢ƒå˜é‡**ï¼š
    åœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
    - `DASHBOARD_PWD`ï¼šè®¾ç½®ä¸€ä¸ªå¤æ‚çš„å¯†ç ï¼Œç”¨äºç™»å½•ç®¡ç†åå°ã€‚
    - `ALLOWED_ORIGIN`ï¼šå…è®¸è·¨åŸŸçš„åŸŸåã€‚
      - è°ƒè¯•å¡«ï¼š`*`
      - ä¸Šçº¿å¡«ï¼š`https://ä½ çš„åšå®¢åŸŸå.com` (å¤šä¸ªåŸŸåç”¨é€—å·åˆ†éš”)

5.  **éƒ¨ç½²ä¸Šçº¿**ï¼š
    ä¿å­˜é…ç½®å¹¶è§¦å‘ä¸€æ¬¡é‡æ–°éƒ¨ç½²ã€‚éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šè·å¾—ä¸€ä¸ª `*.edgeone.dev` (æˆ–ç±»ä¼¼) çš„è®¿é—®åœ°å€ï¼Œè¿™å°±æ˜¯ä½ çš„ **API æœåŠ¡åœ°å€**ã€‚

> éœ€è¦ç»‘å®šè‡ªå·±çš„åŸŸåä½œä¸º API åœ°å€ï¼ŒEdge One Pagesé»˜è®¤æä¾›çš„åŸŸåå­˜åœ¨è®¿é—®æœŸé™ã€‚æœªå¤‡æ¡ˆåŸŸååŠ é€ŸåŒºåŸŸè¯·é€‰æ‹©å…¨çƒå¯ç”¨åŒºï¼ˆä¸å«ä¸­å›½å¤§é™†ï¼‰ã€‚

## ğŸ’» ç¬¬äºŒæ­¥ï¼šå‰ç«¯é›†æˆï¼ˆZensical/Mkdocs-materialï¼‰

### 1. å¼•å…¥ç»Ÿè®¡è„šæœ¬

é’ˆå¯¹ **MkDocs-Material** å’Œ **Zensical** è¿™ç±»ç°ä»£é™æ€æ–‡æ¡£ç«™ç‚¹ï¼Œç”±äºå®ƒä»¬é€šå¸¸ä½¿ç”¨äº† Instant Loading (PJAX/SPA) æŠ€æœ¯ï¼Œä¼ ç»Ÿçš„ `window.onload` åŸ‹ç‚¹å¾€å¾€ä¼šåœ¨é¡µé¢è·³è½¬æ—¶å¤±æ•ˆã€‚

ä¸ºäº†ç¡®ä¿**æ— è®ºæ˜¯é¦–æ¬¡åŠ è½½è¿˜æ˜¯ç«™å†…è·³è½¬ï¼Œéƒ½èƒ½å‡†ç¡®ç»Ÿè®¡ PV**ï¼Œè¯·åœ¨`docs/javascripts/`è·¯å¾„ä¸‹åˆ›å»º`count.js`æ–‡ä»¶ã€‚

ç„¶åå°†ä¸‹è¿°ä»£ç ç²˜è´´è¿›å»ï¼š

```js
// ç½‘ç«™è®¡æ•°å™¨ï¼ŒPVç»Ÿè®¡
// docs/javascripts/count.js

(function() {
  // === âš ï¸äº‘ç«¯ Worker API åœ°å€ï¼Œè¯·åŠ¡å¿…å°†æ­¤å¤„å¡«å†™ä¸ºè‡ªå·±çš„ EdgeOne Pagesè®¿é—®åŸŸå/api/visitçš„å½¢å¼===
  const WORKER_URL = "https://example.com/api/visit";

  function fetchStats() {
    const siteElem = document.getElementById("site_pv");
    const pageElem = document.getElementById("page_pv");

    // å¦‚æœé¡µé¢ä¸Šæ‰¾ä¸åˆ°è¿™ä¸¤ä¸ªå…ƒç´ ï¼ˆæ¯”å¦‚è¿˜æ²¡åŠ è½½å®Œï¼‰ï¼Œå°±ä¸æ‰§è¡Œ
    if (!siteElem || !pageElem) return;

    // è·å–å½“å‰è·¯å¾„
    const currentPath = window.location.pathname;

    // å‘é€è¯·æ±‚
    fetch(`${WORKER_URL}/?url=${encodeURIComponent(currentPath)}`)
      .then(response => response.json())
      .then(data => {
        // æ›´æ–°é¡µé¢æ•°å­—
        siteElem.innerText = data.total;
        pageElem.innerText = data.page;
      })
      .catch(err => {
        console.error("è®¿é—®ç»Ÿè®¡å‡ºé”™:", err);
        // å‡ºé”™æ—¶å¯ä»¥æ˜¾ç¤º "--" æˆ–è€…éšè—
        siteElem.innerText = "--";
        pageElem.innerText = "--";
      });
  }

  // === å…³é”®é€»è¾‘ï¼šå¤„ç† MkDocs Material/Zensical çš„åŠ è½½æœºåˆ¶ ===
  
  // æ£€æŸ¥æ˜¯å¦æ”¯æŒ Instant Loading (MkDocs Material ç‰¹æ€§)
  if (typeof document$ !== "undefined") {
    // å¦‚æœå¼€å¯äº† Instant Loadingï¼ŒRxJS çš„ document$ ä¼šè´Ÿè´£ç›‘å¬æ‰€æœ‰è·³è½¬ï¼ˆåŒ…æ‹¬é¦–æ¬¡åŠ è½½ï¼‰
    document$.subscribe(function() {
      // è¿™é‡Œçš„ setTimeout æ˜¯å¿…é¡»çš„ï¼Œç­‰å¾…é¡µé¢ DOM æ›¿æ¢å®Œæˆ
      setTimeout(fetchStats, 100);
    });
  } else {
    // å¦‚æœæ²¡æœ‰å¼€å¯ Instant Loadingï¼Œåˆ™å›é€€åˆ°æ ‡å‡†çš„ DOMContentLoaded
    document.addEventListener("DOMContentLoaded", fetchStats);
  }
})();
```

!!! warning
    å‡è®¾ä½ çš„ EdgeOne Pages é¡¹ç›®çš„**è®¿é—®åœ°å€**ä¸ºï¼šhttps://your-eocount.comï¼Œåˆ™ä½ éœ€è¦åœ¨å‰ç«¯ js ä»£ç ä¸­è®¾ç½®çš„ WORKER_URL åœ°å€ä¸ºï¼šhttps://your-eocount.com/api/visit

    **ç¯å¢ƒå˜é‡å¿…é¡»é…ç½®**âœ…

    DASHBOARD_PWD ç”¨äºç®¡ç†å‘˜æ§åˆ¶å°ç™»å½•å¯†é’¥ï¼Œç”¨äº `api/admin.js` çš„èº«ä»½éªŒè¯ï¼ˆ`X-Auth-Token`ï¼‰ã€‚

    ALLOWED_ORIGIN ç¤ºä¾‹åœºæ™¯å¦‚ä¸‹ï¼ˆ**è¯·å‹¿é—æ¼`https://`**ï¼‰ï¼š

      - åœºæ™¯ 1ï¼šä»…ç”Ÿäº§ç¯å¢ƒ
          ALLOWED_ORIGIN = https://yourblog.com,https://www.yourblog.com
      - åœºæ™¯ 2ï¼šç”Ÿäº§ç¯å¢ƒ + æœ¬åœ°å¼€å‘
          ALLOWED_ORIGIN = https://yourblog.com,http://localhost:3000
      - åœºæ™¯ 3ï¼šå®Œå…¨å¼€æ”¾ (ä»…æµ‹è¯•ç”¨)
          ALLOWED_ORIGIN = *

### 2. ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `zensical.toml`æˆ–è€…`mkdocs.yml`ï¼Œå¼•å…¥åˆšæ‰åˆ›å»ºçš„è„šæœ¬ï¼š

=== "zensical.toml"
    ```toml
    [project]
    extra_javascript = [
        "javascripts/count.js" # è®¿é—®è®¡æ•°è„šæœ¬
    ]
    ```

=== "mkdocs.yml"
    ```yaml
    extra_javascript:
      - assets/js/counter.js # è®¿é—®è®¡æ•°è„šæœ¬
    ```

### 3. æ’å…¥å±•ç¤º HTML

ä¸ºäº†ç¾è§‚ï¼Œå»ºè®®é€šè¿‡ **Overrides** æœºåˆ¶å°†ç»Ÿè®¡æ˜¾ç¤ºåœ¨é¡µè„šã€‚

!!! note "è®¾ç½®æ¨¡æ¿è¦†ç›–"
    è¦æ·»åŠ æ–°æ¨¡æ¿æˆ–è¦†ç›–ç°æœ‰æ¨¡æ¿çš„éƒ¨åˆ†å†…å®¹ï¼Œé¦–å…ˆéœ€è¦é…ç½® custom_dir è®¾ç½®ï¼Œä½¿å…¶æŒ‡å‘å­˜å‚¨æ¨¡æ¿è¦†ç›–æ–‡ä»¶çš„ç›®å½•ï¼š

    === "zensical.toml"
        ```toml
        [project.theme]
        custom_dir = "overrides"
        ```

    === "mkdocs.yml"
        ```yaml
        theme:
          custom_dir: overrides
        ```

    `custom_dir` è·¯å¾„ç›¸å¯¹äºæ‚¨çš„é…ç½®æ–‡ä»¶è¿›è¡Œè§£æã€‚

åˆ›å»º `overrides/partials/footer.html` (å¦‚æœä¸å­˜åœ¨åˆ™æ–°å»ºæ–‡ä»¶å¤¹)ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```html
<!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  {% if "navigation.footer" in features %}
    {% if page.previous_page or page.next_page %}
      {% if page.meta and page.meta.hide %}
        {% set hidden = "hidden" if "footer" in page.meta.hide %}
      {% endif %}
      <nav
        class="md-footer__inner md-grid"
        aria-label="{{ lang.t('footer') }}"
        {{ hidden }}
      >

        <!-- Link to previous page -->
        {% if page.previous_page %}
          {% set direction = lang.t("footer.previous") %}
          <a
            href="{{ page.previous_page.url | url }}"
            class="md-footer__link md-footer__link--prev"
            aria-label="{{ direction }}: {{ page.previous_page.title | e }}"
          >
            <div class="md-footer__button md-icon">
              {% set icon = config.theme.icon.previous or "material/arrow-left" %}
              {% include ".icons/" ~ icon ~ ".svg" %}
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                {{ direction }}
              </span>
              <div class="md-ellipsis">
                {{ page.previous_page.title }}
              </div>
            </div>
          </a>
        {% endif %}

        <!-- Link to next page -->
        {% if page.next_page %}
          {% set direction = lang.t("footer.next") %}
          <a
            href="{{ page.next_page.url | url }}"
            class="md-footer__link md-footer__link--next"
            aria-label="{{ direction }}: {{ page.next_page.title | e }}"
          >
            <div class="md-footer__title">
              <span class="md-footer__direction">
                {{ direction }}
              </span>
              <div class="md-ellipsis">
                {{ page.next_page.title }}
              </div>
            </div>
            <div class="md-footer__button md-icon">
              {% set icon = config.theme.icon.next or "material/arrow-right" %}
              {% include ".icons/" ~ icon ~ ".svg" %}
            </div>
          </a>
        {% endif %}
      </nav>
    {% endif %}
  {% endif %}

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      {% include "partials/copyright.html" %}

      <!-- Site Visits -->
      <style>
      .site-visit-count {
        padding: 0 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.65rem;
        color: var(--md-default-fg-color);
      }
      </style>
      <div class="site-visit-count">
        æœ¬ç«™è®¿é—®é‡ï¼š<span id="site_pv">--</span>&nbsp;| å½“å‰é¡µæµè§ˆé‡ï¼š<span id="page_pv">--</span>
      </div>

      <!-- Social links -->
      {% if config.extra.social %}
        {% include "partials/social.html" %}
      {% endif %}
    </div>
  </div>
</footer>
```


## ğŸ“Š ç¬¬ä¸‰æ­¥ï¼šç®¡ç†ä¸ç»´æŠ¤

éƒ¨ç½²å®Œæˆåï¼Œç›´æ¥è®¿é—®ä½ çš„ EdgeOne Pages åŸŸåï¼ˆä¾‹å¦‚ `https://example.edgeone.dev`ï¼‰ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªç²¾ç¾çš„å¯è§†åŒ–ä»ªè¡¨ç›˜ã€‚

1.  **ç™»å½•**ï¼šè¾“å…¥åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®çš„ `DASHBOARD_PWD`ã€‚
2.  **åŠŸèƒ½**ï¼š
    - **Dashboard**ï¼šæŸ¥çœ‹å…¨ç«™ PV è¶‹åŠ¿ã€‚
    - **Pages Management**ï¼šæœç´¢ç‰¹å®šæ–‡ç« è·¯å¾„ï¼ŒæŸ¥çœ‹å•ç¯‡é˜…è¯»é‡ã€‚
    - **Edit/Delete**ï¼šå¦‚æœæŸç¯‡æ–‡ç« æ”¹åäº†ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ—§è·¯å¾„çš„ PV æ•°å€¼ï¼Œæˆ–è€…åˆ é™¤æµ‹è¯•æ•°æ®ã€‚

> **ğŸ’¡ è®¾è®¡å“²å­¦è¯´æ˜**ï¼š
> å½“ä½ åœ¨åå°åˆ é™¤æŸä¸ªå­é¡µé¢çš„æ•°æ®æ—¶ï¼Œ**å…¨ç«™æ€» PV (`site_total_pv`) ä¼šåŒæ­¥æ‰£å‡**ã€‚
> ä½†å½“ä½ **ä¿®æ”¹**æŸä¸ªå­é¡µé¢çš„ PV æ—¶ï¼Œ**å…¨ç«™æ€» PV ä¸ä¼šè‡ªåŠ¨å˜åŒ–**ã€‚è¿™æ˜¯å› ä¸ºå…¨ç«™ PV ä»£è¡¨çš„æ˜¯å†å²ç´¯è®¡ç‚¹å‡»ï¼Œè€Œå­é¡µé¢ PV ä¿®æ­£é€šå¸¸æ˜¯ä¸ºäº†æ•°æ®å¯¹é½æˆ–è¿ç§»ï¼Œä¸¤è€…åœ¨é€»è¾‘ä¸Šæ˜¯è§£è€¦çš„ã€‚

## ğŸ‰ ç»“è¯­

é€šè¿‡ EO-Counterï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†åšå®¢çš„è®¿é—®ç»Ÿè®¡æƒæ”¶å›åˆ°äº†è‡ªå·±æ‰‹ä¸­ã€‚å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ç½‘ç«™ç»Ÿè®¡åˆ†æçš„è§£å†³æ–¹æ¡ˆï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ª **EO-Counter** ï¼

æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„éƒ¨ç½²ä½“éªŒï¼Œæˆ–åœ¨ GitHub ä¸Šä¸ºé¡¹ç›®ç‚¹æ˜Ÿï¼ğŸŒŸ

## ç•ªå¤–ï¼šä½¿ç”¨ Cloudflare Workers ä¸º Zensical ç«™ç‚¹å¼•å…¥è®¿é—®ç»Ÿè®¡

### æ¥å…¥æ­¥éª¤
1. ä¸ä¸Šæ–‡ [å¼•å…¥ç»Ÿè®¡è„šæœ¬](#1)æ­¥éª¤ç›¸åŒï¼Œæ³¨æ„å°†`WORKER_URL`æ›¿æ¢ä¸º`Cloudflare Worker`è®¿é—®åœ°å€ã€‚
2. ä¸ä¸Šæ–‡ [ä¿®æ”¹é…ç½®æ–‡ä»¶](#2)æ­¥éª¤ç›¸åŒã€‚
3. ä¸ä¸Šæ–‡ [æ’å…¥å±•ç¤º HTML](#3-html)æ­¥éª¤ç›¸åŒã€‚
4. åˆ›å»ºä¸€ä¸ª`Cloudflare Worker`é¡¹ç›®ï¼Œç»‘å®šKVå­˜å‚¨ï¼ŒKVç©ºé—´`Variable name`è®¾ç½®ä¸º`COUNTER_DB`ï¼Œç‚¹å‡»`Edit code`ï¼Œæ¸…ç©ºåŸæœ‰çš„ä»£ç ï¼Œå°†ä»¥ä¸‹ä»£ç å¡«å…¥ï¼š
```js
export default {
  async fetch(request, env, ctx) {
    // === é…ç½®å…è®¸çš„åŸŸå ===
    // å»ºè®®åŒæ—¶åŠ ä¸Š localhostï¼Œå¦åˆ™ä½ åœ¨æœ¬åœ°è°ƒè¯•æ—¶ä¼šæŠ¥é”™è·¨åŸŸï¼Œæˆ–è€…ç»Ÿè®¡ä¸åˆ°æ•°æ®
    // å¦‚æœä½ åªæƒ³åœ¨çº¿ä¸Šç”Ÿæ•ˆï¼Œå¯ä»¥å»æ‰ localhost çš„é‚£ä¸€è¡Œ
    const ALLOWED_ORIGINS = [
      "https://example.com",           // ä½ çš„çº¿ä¸Šåšå®¢åœ°å€
      "https://www.example.com",       // å…¼å®¹www
      "http://127.0.0.1:8000",         // æœ¬åœ°é¢„è§ˆåœ°å€
      "http://localhost:8000"          // å¤‡ç”¨æœ¬åœ°åœ°å€
    ];

    // è·å–è¯·æ±‚æ¥æº (Origin ä¸»è¦æ˜¯ fetch è¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Š)
    const origin = request.headers.get("Origin");
    
    // === 1. å®‰å…¨æ£€æŸ¥ä¸ CORS è®¾ç½® ===
    
    // é»˜è®¤ç¦æ­¢
    let allowOrigin = null;

    // å¦‚æœè¯·æ±‚æºå¸¦äº† Origin å¤´ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦åœ¨ç™½åå•é‡Œ
    if (origin && ALLOWED_ORIGINS.includes(origin)) {
      allowOrigin = origin;
    } else if (!origin) {
      // éƒ¨åˆ†è¯·æ±‚å¯èƒ½æ²¡æœ‰ Origin (æ¯”å¦‚ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥)ï¼Œ
      // è¿™é‡Œçš„ç­–ç•¥æ˜¯ï¼šå¦‚æœæ²¡æœ‰ Originï¼Œä¸ºäº†å®‰å…¨é€šå¸¸å¯ä»¥é€‰æ‹©æ‹’ç»ï¼Œ
      // ä½†ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œè¿™é‡Œæš‚æ—¶æ”¾è¡Œï¼Œæˆ–è€…ä½ å¯ä»¥æ£€æŸ¥ Refererã€‚
      // ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå»ºè®®ä¿æŒ nullã€‚
      
      // ç®€å•çš„é˜²ç›—é“¾ï¼šæ£€æŸ¥ Referer (å¼•ç”¨é¡µ)
      const referer = request.headers.get("Referer");
      if (referer && referer.startsWith("https://sufine.top")) {
         // å¦‚æœ Referer æ˜¯ä½ çš„åŸŸåï¼Œä¹Ÿå…è®¸ï¼ŒCORS å¤´è®¾ä¸ºä½ çš„åŸŸå
         allowOrigin = "https://sufine.top";
      }
    }

    // å‡†å¤‡è¿”å›çš„ Header
    const corsHeaders = {
      // åŠ¨æ€è®¾ç½® Allow-Originï¼Œå¦‚æœä¸åœ¨ç™½åå•å°±è®¾ä¸º null æˆ–ä¸è¿”å›è¯¥å¤´
      "Access-Control-Allow-Origin": allowOrigin || "null", 
      "Access-Control-Allow-Methods": "GET,HEAD,POST,OPTIONS",
      "Access-Control-Max-Age": "86400",
    };

    // å¦‚æœä¸åœ¨ç™½åå•ï¼Œä¸”ä¸æ˜¯ OPTIONS é¢„æ£€è¯·æ±‚ï¼Œç›´æ¥æ‹’ç» (è¿”å› 403 Forbidden)
    if (!allowOrigin && request.method !== "OPTIONS") {
      // åªæœ‰å½“ origin å­˜åœ¨ä¸”ä¸åœ¨ç™½åå•æ—¶æ‰æ‹’ç»ã€‚
      // å¦‚æœå®Œå…¨æ²¡æœ‰ origin (æ¯”å¦‚ curl)ï¼Œè§†ä½ çš„å®‰å…¨éœ€æ±‚å†³å®šæ˜¯å¦æ‹¦æˆªã€‚
      // è¿™é‡Œä¸ºäº†é˜²æ­¢è¢«æ»¥ç”¨ï¼Œå¦‚æœ origin å­˜åœ¨ä½†ä¸åŒ¹é…ï¼Œç›´æ¥æ‹¦æˆªã€‚
      if (origin) {
        return new Response("Forbidden: Origin not allowed", { status: 403 });
      }
    }

    // å¤„ç† OPTIONS é¢„æ£€è¯·æ±‚
    if (request.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders });
    }

    // === 2. è·å–æ–‡ç« è·¯å¾„ ===
    const url = new URL(request.url);
    const pagePath = url.searchParams.get("url");

    if (!pagePath) {
      return new Response("Error: Missing url parameter", { 
        status: 400, 
        headers: corsHeaders 
      });
    }

    // === 3. è¯»å–æ•°æ®åº“ ===
    const TOTAL_KEY = "TOTAL_VIEWS";
    let totalViews = await env.COUNTER_DB.get(TOTAL_KEY);
    let pageViews = await env.COUNTER_DB.get(pagePath);

    if (!totalViews) totalViews = 0;
    if (!pageViews) pageViews = 0;

    // === 4. æ•°å­— +1 ===
    totalViews = parseInt(totalViews) + 1;
    pageViews = parseInt(pageViews) + 1;

    // === 5. å­˜å›æ•°æ®åº“ ===
    ctx.waitUntil(env.COUNTER_DB.put(TOTAL_KEY, totalViews.toString()));
    ctx.waitUntil(env.COUNTER_DB.put(pagePath, pageViews.toString()));

    // === 6. è¿”å›ç»“æœ ===
    const result = {
      total: totalViews,
      page: pageViews
    };

    return new Response(JSON.stringify(result), {
      headers: { 
        "Content-Type": "application/json",
        ...corsHeaders 
      },
    });
  },
};
```
å°†è‡ªå·±çš„ç«™ç‚¹åŸŸåå¡«å…¥ `ALLOWED_ORIGINS` å˜é‡ä¸­ã€‚

è‡³æ­¤ï¼Œæ‰€æœ‰çš„æ­¥éª¤éƒ½å·²ç»å®Œæˆäº†ï¼Œç†æƒ³æƒ…å†µåº”è¯¥å¯ä»¥åœ¨ç«™ç‚¹é¡µè„šçœ‹åˆ°è®¿é—®ç»Ÿè®¡æ•°æ®ã€‚

### æç¤ºäº‹é¡¹

!!! note ""
    æ³¨æ„ï¼ŒCloudflare çš„ Workers KV API å­˜åœ¨æ¯æ—¥1000æ¬¡çš„å†™å…¥é™é¢ï¼ˆå…è´¹ç‰ˆï¼‰ã€‚

    åŸºäº Cloudflare çš„ç«™ç‚¹ç»Ÿè®¡æ–¹æ¡ˆæœªåšå¯è§†åŒ–åå°ç›‘æ§å±ï¼Œæ•°æ®ç®¡ç†éœ€è¦ä½¿ç”¨å®˜ç½‘ Workers KV é¢æ¿ã€‚